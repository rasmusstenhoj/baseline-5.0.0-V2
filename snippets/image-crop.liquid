{%- liquid
  unless sizes
    assign sizes = '100vw'
  endunless

  unless widths
    assign widths = '200, 350, 450, 750, 850, 960, 1280, 1440, 1536, 1706, 1782, 1920, 2560, 2880, 3000'
  endunless

  unless loading
    assign loading = null
  endunless

  unless preload
    assign preload = false
  endunless

  if preload
    assign fetchpriority = 'high'
  else
    assign fetchpriority = null
  endif

  unless is_thumbnail
    assign is_thumbnail = false
  endunless

  unless is_deep_inset
    assign is_deep_inset = false
  endunless

  unless always_show_border_radius
    assign always_show_border_radius = false
  endunless

  if contain
    assign object_class = 'object-contain'
  else
    assign object_class = 'object-cover'
  endif
-%}

{% if ratio == 0 %}
  {% render 'image',
    image: image,
    sizes: sizes,
    preload: preload,
    loading: loading,
    is_deep_inset: is_deep_inset,
    is_thumbnail: is_thumbnail,
    always_show_border_radius: always_show_border_radius
  %}
{% else %}
  {% liquid
    assign image_classes = 'image peer/image absolute inset-0 size-full overflow-hidden ' | append: object_class
    assign element_classes = 'relative aspect-media overflow-hidden w-full'

    if settings.grid_media_style == 'inset' and settings.show_inset_media_border
      assign element_classes = element_classes | append: ' border-gridline border-gridline-color'
    endif

    if settings.zoom_media_on_hover
      assign image_classes = image_classes | append: ' motion-safe:group-hover/zoom:scale-[var(--zoom-media-scale)]  motion-safe:transition-transform duration-300 ease-zoom'
    endif

    if always_show_border_radius
      assign element_classes = element_classes | append: ' rounded-media'
    elsif is_thumbnail
      assign element_classes = element_classes | append: ' rounded-thumbnail'
    else
      if is_deep_inset
        assign element_classes = element_classes | append: ' rounded-deep-inset-media'
      else
        assign element_classes = element_classes | append: ' rounded-grid-media'
      endif
    endif
  %}
  <image-with-placeholder
    class="{{ element_classes }}"
    style="--media-aspect-ratio: {{ ratio }};"
  >
    {% if image %}
      {{-
        image
        | image_url: width: 3000
        | image_tag:
          loading: loading,
          preload: preload,
          fetchpriority: fetchpriority,
          class: image_classes,
          sizes: sizes,
          widths: widths
      }}
    {% endif %}
    <div
      class="absolute inset-0 h-full w-full bg-scheme-text opacity-[0.05] peer-[.is-complete]/image:opacity-0 no-js:hidden"
    ></div>

    {% if hotspots %}
      {{ hotspots }}
    {% endif %}
  </image-with-placeholder>
{% endif %}
